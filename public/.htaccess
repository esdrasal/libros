RewriteEngine On

# Handle Angular and other front-end routes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Try to serve request as file, then as directory, then fall back to Rails
RewriteRule ^(.*)$ /dispatch.cgi/$1 [QSA,L]

# For Rails on Apache with Passenger
<IfModule mod_passenger.c>
  PassengerEnabled on
  PassengerAppRoot /home/username/domains/yourdomain.com/public_html
  PassengerBaseURI /
  PassengerMinInstances 1
</IfModule>

# Handle Rails static files
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
  ExpiresActive On
  ExpiresDefault "access plus 1 year"
</FilesMatch>

# Security headers
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-Content-Type-Options "nosniff"
Header always set X-XSS-Protection "1; mode=block"

# Force HTTPS (opcional)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]